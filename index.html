<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- Compiled and minified CSS -->
        <link rel="stylesheet" href="https://cdn.bootcss.com/materialize/1.0.0/css/materialize.min.css">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <title>梗体中文在线打包</title>
    </head>
    <body>
        <nav>
            <div class="nav-wrapper light-blue darken-1">
              <a href="#" class="brand-logo center">梗体中文</a>
            </div>
        </nav>
        <div class="container">
            <!--WIP-->
            <form id="argument">
                <div class="row">
                    <div class="col s12">
                        <h1>在线打包选项</h1>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s6">
                        <select name="type">
                            <option value="normal">普通版本</option>
                            <option value="compat">兼容版本</option>
                        </select>
                        <label>语言版本</label>
                    </div>
                    <div class="input-field col s6">
                        <select name="figure">
                            <option value="all">全部</option>
                            <option value="none">无</option>
                            <option>自定义（见下）</option>
                        </select>
                        <label>材质选择</label>
                    </div>
                    <div class="col s12">
                        <label>
                            <input type="checkbox" class="filled-in" name="sfw" value="true">
                            <span>Suitable for work ("_sfw")</span>
                            <input type="hidden" name="sfw" value="false">
                        </label>
                        <label>
                            <input type="checkbox" class="filled-in" name="legacy" value="true">
                            <span>旧版（1.12.2以下）语言文件格式</span>
                            <input type="hidden" name="legacy" value="false">
                        </label>
                    </div>
                    <div class="input-field col s6">
                        <select name="include">
                            <option value="all">所有Mod内容</option>
                            <option value="none">无Mod内容</option>
                            <option>自定义（见下）</option>
                        </select>
                        <label>Mod内容选择</label>
                    </div>
                    <div class="input-field col s6">
                        <select name="include" multiple>
                            <optgroup label="Mod文件">
                                {% for item in mods %}
                                <option value="{{item}}">{{item}}</option>
                                {% endfor %}
                            </optgroup>
                            <optgroup label="Mod文件（未汉化）">
                                {% for item in enmods %}
                                <option value="{{item}}">{{item}}</option>
                                {% endfor %}
                            </optgroup>
                            <optgroup label="附加内容">
                                {% for item in optionals %}
                                <option value="{{item}}">{{item}}</option>
                                {% endfor %}
                            </optgroup>
                        </select>
                        <label>Mod/附加内容选择</label>
                    </div>
                </div>
                <div class="col s3">
                    <button class="waves-effect waves-light btn" id="submitButton"><i class="material-icons left">cloud_download</i>提交构建选项</button>
                </div>
            </form>
            <div class="row">
                <div class="col s12">
                    <h1 id="resultTitle" style="display:none;">返回结果</h1>
                </div>
                <pre><code id="message" class="col s12"></code></pre>
            </div>
        </div>
        <!--Import jQuery before materialize.js-->
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <!-- Compiled and minified JavaScript -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
        <script type="text/javascript">$(document).ready(function(){$('select').formSelect();});</script>
        <script type="text/javascript">
            function HTMLEncode(html) {
                var temp = document.createElement("div");
                (temp.textContent != null) ? (temp.textContent = html) : (temp.innerText = html);
                var output = temp.innerHTML;
                temp = null;
                return output;
            }
            $('#submitButton').click(function(){
                var formObject = {}
                var formArray = $("#argument").serializeArray();
                $.each(formArray,function(i,item){
                    formObject[item.name] = item.value;
                });
                $.ajax({
                    url:"/ajax",
                    type:"post",
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(formObject),
                    dataType: "json",
                    success:function(data){
                        document.getElementById("resultTitle").style.display = "inherit";
                        document.getElementById("message").innerHTML += HTMLEncode(data)
                    },
                    error:function(e){
                        document.getElementById("resultTitle").style.display = "inherit";
                        document.getElementById("message").innerHTML += HTMLEncode(e)
                    }
                });
            });
        </script>
    </body>
</html>